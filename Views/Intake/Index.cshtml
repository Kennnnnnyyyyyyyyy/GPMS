@model Gate_Pass_management.Services.CreateAppointmentRequest
@{
    ViewData["Title"] = "Visitor Intake Form";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">
                        <i class="fas fa-user-plus me-2"></i>
                        Visitor Registration
                    </h4>
                    <p class="mb-0 mt-2">Please fill out this form to schedule your visit</p>
                </div>
                <div class="card-body">
                    <form asp-action="Submit" method="post" class="needs-validation" novalidate>
                        @Html.AntiForgeryToken()
                        
                        <!-- Visitor Information -->
                        <div class="row mb-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-user me-2"></i>Visitor Information
                                </h5>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="VisitorName" class="form-label">Full Name *</label>
                                <input asp-for="VisitorName" class="form-control" required>
                                <span asp-validation-for="VisitorName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Mobile" class="form-label">Mobile Number *</label>
                                <input asp-for="Mobile" class="form-control" type="tel" required>
                                <span asp-validation-for="Mobile" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="Email" class="form-label">Email Address</label>
                                <input asp-for="Email" class="form-control" type="email">
                                <span asp-validation-for="Email" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Company" class="form-label">Company/Organization</label>
                                <input asp-for="Company" class="form-control">
                                <span asp-validation-for="Company" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <!-- Visit Information -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-calendar-alt me-2"></i>Visit Information
                                </h5>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-12">
                                <label asp-for="PurposeOfVisit" class="form-label">Purpose of Visit *</label>
                                <textarea asp-for="PurposeOfVisit" class="form-control" rows="3" required 
                                          placeholder="Please describe the purpose of your visit"></textarea>
                                <span asp-validation-for="PurposeOfVisit" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label asp-for="ScheduledDate" class="form-label">Visit Date *</label>
                                <input asp-for="ScheduledDate" class="form-control" type="date" required>
                                <span asp-validation-for="ScheduledDate" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="ScheduledTime" class="form-label">Visit Time *</label>
                                <input asp-for="ScheduledTime" class="form-control" type="time" required>
                                <span asp-validation-for="ScheduledTime" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label asp-for="EstimatedDurationMinutes" class="form-label">Duration (minutes)</label>
                                <select asp-for="EstimatedDurationMinutes" class="form-select">
                                    <option value="30">30 minutes</option>
                                    <option value="60" selected>1 hour</option>
                                    <option value="90">1.5 hours</option>
                                    <option value="120">2 hours</option>
                                    <option value="180">3 hours</option>
                                    <option value="240">4 hours</option>
                                </select>
                                <span asp-validation-for="EstimatedDurationMinutes" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <!-- Host Information -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-user-tie me-2"></i>Host Information
                                </h5>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="HostName" class="form-label">Host Name *</label>
                                <input asp-for="HostName" class="form-control" required 
                                       placeholder="Name of person you're visiting">
                                <span asp-validation-for="HostName" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="HostDepartment" class="form-label">Host Department</label>
                                <input asp-for="HostDepartment" class="form-control" 
                                       placeholder="Department or division">
                                <span asp-validation-for="HostDepartment" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label asp-for="HostEmployeeId" class="form-label">Host Employee ID</label>
                                <input asp-for="HostEmployeeId" class="form-control" 
                                       placeholder="Employee ID (if known)">
                                <span asp-validation-for="HostEmployeeId" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="HostContactNumber" class="form-label">Host Contact Number</label>
                                <input asp-for="HostContactNumber" class="form-control" type="tel" 
                                       placeholder="Host's contact number">
                                <span asp-validation-for="HostContactNumber" class="text-danger"></span>
                            </div>
                        </div>
                        
                        <!-- Location Info -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-building me-2"></i>Location
                                </h5>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Visit Location</label>
                                <select asp-for="VisitLocation" class="form-select">
                                    <option value="Main Office">Main Office</option>
                                    <option value="Mumbai">Mumbai</option>
                                    <option value="Chennai">Chennai</option>
                                    <option value="Ahmedabad">Ahmedabad</option>
                                </select>
                            </div>
                        </div>

                        <!-- Vehicle Parking -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-car me-2"></i>Vehicle Parking
                                </h5>
                            </div>
                        </div>
                        <div class="row mb-3 align-items-center">
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" asp-for="ArrivingWithVehicle" id="arrivingWithVehicle">
                                    <label class="form-check-label" for="arrivingWithVehicle">Arriving with vehicle</label>
                                </div>
                            </div>
                            <div class="col-md-4 vehicle-fields d-none">
                                <label class="form-label">Vehicle Type</label>
                                <select asp-for="VehicleType" class="form-select">
                                    <option value="">Select</option>
                                    <option value="2-wheeler">2 wheeler</option>
                                    <option value="4-wheeler">4 wheeler</option>
                                </select>
                            </div>
                            <div class="col-md-4 vehicle-fields d-none">
                                <label class="form-label">Vehicle Number</label>
                                <input asp-for="VehicleNumber" class="form-control" placeholder="e.g., MH12AB1234" />
                            </div>
                        </div>

                        <!-- Food Options -->
                        <div class="row mb-4 mt-4">
                            <div class="col-12">
                                <h5 class="text-primary border-bottom pb-2">
                                    <i class="fas fa-utensils me-2"></i>Food & Refreshments
                                </h5>
                            </div>
                        </div>
                        <div class="row mb-3 align-items-center">
                            <div class="col-md-4">
                                <label class="form-label">Food required?</label>
                                <select asp-for="FoodRequired" class="form-select" id="foodRequired">
                                    <option value="false">No</option>
                                    <option value="true">Yes</option>
                                </select>
                            </div>
                            <div class="col-md-4 food-fields d-none">
                                <label class="form-label">Food Preference</label>
                                <select asp-for="FoodPreference" class="form-select">
                                    <option value="Veg">Veg</option>
                                    <option value="Non-Veg">Non Veg</option>
                                    <option value="Both">Both</option>
                                </select>
                            </div>
                            <div class="col-md-4 food-fields d-none">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" asp-for="ComplimentaryDrink" id="complimentaryDrink">
                                    <label class="form-check-label" for="complimentaryDrink">Complimentary drink</label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Submit Button -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="/Scheduler" class="btn btn-outline-secondary btn-lg me-md-2">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        Meeting Scheduler
                                    </a>
                                    <button type="submit" class="btn btn-primary btn-lg px-5">
                                        <i class="fas fa-paper-plane me-2"></i>
                                        Submit Registration
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Instructions -->
                        <div class="alert alert-info mt-4">
                            <h6><i class="fas fa-info-circle me-2"></i>What happens next?</h6>
                            <ul class="mb-0">
                                <li>Your appointment request will be sent for approval</li>
                                <li>You will be notified once your visit is approved</li>
                                <li>Please bring a valid photo ID on the day of your visit</li>
                                <li>Report to the main reception with your appointment details</li>
                            </ul>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    
    <script>
        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();
        
        // Set minimum date to today
        document.addEventListener('DOMContentLoaded', function() {
            const dateInput = document.querySelector('input[type="date"]');
            if (dateInput) {
                const today = new Date().toISOString().split('T')[0];
                dateInput.setAttribute('min', today);
            }

            // Toggle vehicle fields
            const arrivingWithVehicle = document.getElementById('arrivingWithVehicle');
            const vehicleFields = document.querySelectorAll('.vehicle-fields');
            function updateVehicleFields() {
                const show = arrivingWithVehicle && arrivingWithVehicle.checked;
                vehicleFields.forEach(el => el.classList.toggle('d-none', !show));
            }
            if (arrivingWithVehicle) {
                arrivingWithVehicle.addEventListener('change', updateVehicleFields);
                updateVehicleFields();
            }

            // Toggle food fields
            const foodRequired = document.getElementById('foodRequired');
            const foodFields = document.querySelectorAll('.food-fields');
            function updateFoodFields() {
                const show = foodRequired && foodRequired.value === 'true';
                foodFields.forEach(el => el.classList.toggle('d-none', !show));
            }
            if (foodRequired) {
                foodRequired.addEventListener('change', updateFoodFields);
                updateFoodFields();
            }
        });
    </script>
}
